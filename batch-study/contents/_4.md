
# ElasticSearch 개념 훑기

## Intro

- 클러스터와 노드의 의미
- 인덱스와 타입의 의미
- 샤드와 세그먼트의 의미
- 매핑(Mapping)의 역할과 의미

## 클러스터와 노드의 의미

- 클러스터란 여러 대의 컴퓨터 혹은 구성 요소들을 논리적으로 결합하여 전체를 하나의 컴퓨터, 혹은 하나의 구성 요소처럼 사용할 수 있게 해주는 기술이다.

- 단일 노드로 클러스터를 구성하는 경우
	- 하나의 노드로 클러스터를 구성하는 경우 해당 노드에 장애가 발생하면 ElasticSearch 클러스터에 접근할 수 없는 요청 불가 상태가 된다.

- 다수 노드로 클러스터를 구성하는 경우
	- 하나의 노드에 장애가 발생해도 다른 노드에 요청할 수 있기 때문에 안정적으로 클러스터를 유지할 수 있다.

### 노드의 역할 

- 마스터
	- 클러스터 구성에서 중심이 되는 노드
	- 클러스터의 상태 등 메타데이터를 관리
	
- 데이터
	- 사용자의 문서를 실제로 저장하는 노드
	
- 인제스트
	- 사용자의 문서가 저장되기 전 문서 내용을 사전 처리하는 노드
	
- 코디네이트
	- 사용자의 요청을 데이터 노드로 전달하고, 다시 데이터 노드로부터 결과를 취합하는 노드

## 인덱스와 타입

- RDBMS의 데이터베이스를 인덱스라 하고, 테이블을 타입이라 한다.

## 샤드와 세그먼트

- 샤드
	- 인덱스에 매우 많은 문서가 저장될 수 있다.
	- 데이터를 분산 저장하는 방식으로 수평 확장이 가능하도록 하는 방식
	- 인덱스에 쿼리를 요청하면 인덱스가 가지고 있는 모든 샤드로 검색 요청이 전달되고 각 샤드에서 1차적으로 검색이 이루어진 후 그 결과를 취합해서 최종 결과로 제공한다.
	- 색인 데이터가 샤드로 분산되는 과정이나 검색 요청이 각 샤드에서 분산되어 처리되는 복잡한 프로세스는 사용자에게 완벽하게 블랙박스로 제공된다.
	
	
### 프라이머리 샤드와 레플리카 샤드

## 매핑


## 정리

1. ElasticSearch는 노드들의 역할을 정의하여 클러스터로 구성하며, 클러스터 단위로 사용자의 색인이나 검색 요청을 받아 서비스한다.

2. 인덱스는 사용자의 문서가 저장되는 가장 큰 논리적인 단위이며, 문제서는 인덱스 내에 샤드라는 단위로 저장된다.

3. 샤드에 저장되는 문서는 실제로는 세그먼트라는 물리적인 파일에 저장된다,

4. 샤드는 하나 이상의 세드먼트들로 구성된다.
	- 백그라운드에서 세그먼트의 병합 작업이 진행되며 이를 통해 작은 크기의 세그먼트들이 큰 크기의 세그먼트로 합쳐진다.
	
5. 샤드는 원본 데이터를 저장하는 프라이머리 샤드와 복제본인 레플리카 샤드로 나뉘며, 하나의 노드에 동일한 번호의 프라이머리/레플리카 샤드를 두지 않음으로써 노드 장애 발생 시 데이터의 안전성을 확보한다.

6. 사용자의 문서가 저장될 때 문서의 데이터를 기준으로 데이터 타입을 정의하며, 문서의 모든 필드에 대해 데이터 타입을 정의한 것이 인덱스의 매핑이다.
